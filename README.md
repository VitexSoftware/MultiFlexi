Multi Flexi
===========

![MFB](multiflexi-social-preview.svg?raw=true)

Umo≈æ≈àuje spou≈°tƒõt zvolen√© n√°stroje nad urƒçit√Ωmi √∫ƒçetn√≠mi jednotkami AbraFlexi v dan√Ωch intervalech. 

Nastaven√© √∫lohy jsou pravidelnƒõ spou≈°tƒõny ze syst√©mov√©cho pl√°novaƒçe.
Protokol spou≈°tƒõn√≠ je zapisov√°n do syst√©mov√©ho logu.

Spou≈°tƒõn√Ωm skript≈Øm jsou nastavoav√°ny tyto promƒõnn√© prost≈ôed√≠:


* **ABRAFLEXI_URL**
* **ABRAFLEXI_LOGIN**
* **ABRAFLEXI_PASSWORD**
* **ABRAFLEXI_COMPANY**

nebo

* **POHODA_ICO**
* **POHODA_URL**
* **POHODA_USERNAME**
* **POHODA_PASSWORD**

‚äï promƒõnn√© prost≈ôed√≠ dle individu√°ln√≠ konfigurace ka≈æd√©ho modulu pro ka≈ædou firmu

Demo
----

K dispozici je [uk√°zkov√° instance](https://demo.multiflexi.eu/?login=demo\&password=demo)

![demo screenshot](doc/index-1.10.4.314.png?raw=true)

Pluginy
-------

Jako plugin je mo≈æn√© pou≈æ√≠t jak√Ωkoliv spustiteln√Ω skript nebo bin√°rku. Uv√°d√≠me zde nƒõkter√©, p≈ôipraven√© k pou≈æit√≠:

|Jm√©no|Popis|Domovsk√° str√°nka|
|-----|-----|----------------|
|Multi Flexi Sonda|Testovac√≠ n√°stroj spou≈°tƒõƒçe √∫loh|https://github.com/VitexSoftware/MultiFlexi|
|Email Importer|Naƒç√≠t√° doklady z mailboxu do FlexiBee|https://github.com/VitexSoftware/AbraFlexi-email-importer|
|discomp2abraflexi|Import Pricelist from Discomp to AbraFlexi|https://github.com/Spoje-NET/discomp2abraflexi|
|AbraFlexi Revolut statements import|Import Revolut bank statemetnts into AbraFlexi|https://github.com/VitexSoftware/AbraFlexi-Revolut|
|AbraFlexi Checker|Kontrola dostupnosti AbraFlexi|https://github.com/VitexSoftware/php-abraflexi-config|
|V≈Øbec p≈ôehled|p≈ôehled va≈°eho √∫ƒçetnictv√≠ od zaƒç√°tku do nynƒõj≈°ka|https://github.com/VitexSoftware/AbraFlexi-Digest/|
|Den√≠ p≈ôehled|ka≈ædoden√≠ p≈ôehled va≈°eho √∫ƒçetnictv√≠|https://github.com/VitexSoftware/AbraFlexi-Digest/|
|Mƒõs√≠ƒçn√≠ p≈ôehled|mƒõs√≠ƒçn√≠ p≈ôehled va≈°eho √∫ƒçetnictv√≠|https://github.com/VitexSoftware/AbraFlexi-Digest/|
|T√Ωden√≠ p≈ôehled|p≈ôehled va≈°eho √∫ƒçetnictv√≠ ka≈æd√Ω t√Ωden|https://github.com/VitexSoftware/AbraFlexi-Digest/|
|Roƒçn√≠ p≈ôehed|Ka≈ædoroƒçn√≠ AbraFlexi p≈ôehled|https://github.com/VitexSoftware/AbraFlexi-Digest/|
|Hromadn√° po≈°ta z AbraFlexi|Na z√°kladƒõ dotazu zvol√≠ p≈ô√≠jmce z adres√°≈ôe a odes√≠l√° mail na z√°kladƒõ ≈°ablony|https://github.com/VitexSoftware/abraflexi-mailer/|
|AbraFlexi odes√≠laƒç|Ode≈°le v≈°echny doklady vydan√Ωch faktur kter√© je≈°tƒõ nebyly odesl√°ny|https://github.com/VitexSoftware/abraflexi-mailer/|
|Odes√≠laƒç po≈°ty|Ode≈°li neodeslan√© dokumenty s p≈ô√≠lohami|https://github.com/VitexSoftware/abraflexi-mailer/|
|Uka≈æ neodeslan√©|Zobraz neodeslan√© dokumenty|https://github.com/VitexSoftware/abraflexi-mailer/|
|Smlouvy na Faktury|Spust√≠ generov√°n√≠ faktur ze smluv v AbraFlexi|https://github.com/VitexSoftware/abraflexi-contract-invoices|
|AbraFlexi Benchmark|AbraFlexi Server Benchmark|https://github.com/VitexSoftware/AbraFlexi-Tools|
|AbraFlexi Copy|Copy Company data between two AbraFlexi servers|https://github.com/VitexSoftware/AbraFlexi-Tools|
|AbraFlexi transaction report|obtain AbraFlexi bank transaction report|https://github.com/VitexSoftware/abraflexi-matcher/|
|AbraFlexi Bank statements puller|Stahni bankovn√≠ v√Ωpisy do AbraFlexi|https://github.com/VitexSoftware/abraflexi-matcher/|
|AbraFlexi Issued invoices Matcher|Ne pouze p√°rovaƒç faktur|https://github.com/VitexSoftware/abraflexi-matcher/|
|P√°rovaƒç p≈ôijat√Ωch Faktur|P√°ruj p≈ôijat√© faktury s odchoz√≠mi platbami|https://github.com/VitexSoftware/abraflexi-matcher/|
|Subreg to AbraFlexi|Import Subreg Pricelist into AbraFlexi|https://github.com/Spoje-NET/subreg2abraflexi/|
|Fio Statement Downloader|Download FioBank statements to disk|https://github.com/Spoje-NET/fiobank-statement-downloader|
|Fio transaction report|FioBank transaction report|https://github.com/Spoje-NET/fiobank-statement-downloader|
|RB statement downloader|Download Raiffeisenbank statements in given format|Download your Statements to directory|
|RB transaction report|Raiffeisenbank transaction report|Download your Statements to directory|
|abraflexi-raiffeisenbank|Stahovaƒç bankovn√≠ch v√Ωpis≈Ø z Raiffeisen banky|https://github.com/VitexSoftware/abraflexi-raiffeisenbank|
|Redmine do AbraFlexi|ƒålovekohodiny v Redmine do faktury v AbraFlexi|https://github.com/VitexSoftware/Redmine2AbraFlexi/|
|ƒåistiƒç ≈°t√≠tk≈Ø upom√≠naƒçe|Vyma≈æe ≈°t√≠tky dlu≈æn√≠k≈Ø|https://github.com/VitexSoftware/abraflexi-reminder|
|P≈ôehled pohled√°vek|Z√≠sk√° neuhrazen√© faktury|https://github.com/VitexSoftware/abraflexi-reminder|
|Notify Customers|Zas√≠lat inventarizaci|https://github.com/VitexSoftware/abraflexi-reminder|
|Upom√≠naƒç|Upom√≠naƒç neuhrazen√Ωch faktur|https://github.com/VitexSoftware/abraflexi-reminder|
|Realpad do Mailkitu|Synchronizuje kontakty z Realpadu do Mailkitu |https://github.com/Spoje-NET/realpad2mailkit/|

Kompletn√≠ seznam naleznete na [str√°nce projektu](https://www.multiflexi.eu/apps.php).

instalace
---------

```shell
sudo apt install lsb-release wget
echo "deb http://repo.vitexsoftware.com $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/vitexsoftware.list
sudo wget -O /etc/apt/trusted.gpg.d/vitexsoftware.gpg http://repo.vitexsoftware.cz/keyring.gpg
sudo apt update
sudo apt install multiflexi-DATABASE
```

k dispozici jsou tyto datab√°zov√© adapt√©ry: **multiflexi-mysql**, **multiflexi-pgsql** a **multiflexi-sqlite**

V√Ωsledn√° instalace pak bude vypadat takto:

```shell
vitex@system:~$ sudo apt install multiflexi-mysql 
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  multiflexi
Suggested packages:
  abraflexi-server abraflexi-digest abraflexi-reminder abraflexi-contract-invoices abraflexi-email-importer
The following NEW packages will be installed:
  multiflexi multiflexi-mysql
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 221 kB of archives.
After this operation, 913 kB of additional disk space will be used.
Do you want to continue? [Y/n] 
Get:1 http://repo.vitexsoftware.cz focal/main amd64 multiflexi-mysql all 1.1~focal~26 [1948 B]
Get:2 http://repo.vitexsoftware.cz focal/main amd64 multiflexi all 1.1~focal~26 [219 kB]
Fetched 221 kB in 0s (2207 kB/s)   
Selecting previously unselected package multiflexi-mysql.
(Reading database ... 139480 files and directories currently installed.)
Preparing to unpack .../multiflexi-mysql_1.1~focal~26_all.deb ...
Unpacking multiflexi-mysql (1.1~focal~26) ...
Selecting previously unselected package multiflexi.
Preparing to unpack .../multiflexi_1.1~focal~26_all.deb ...
Unpacking multiflexi (1.1~focal~26) ...
Setting up multiflexi-mysql (1.1~focal~26) ...
Setting up multiflexi (1.1~focal~26) ...

Determining localhost credentials from /etc/mysql/debian.cnf: succeeded.
dbconfig-common: writing config to /etc/dbconfig-common/multiflexi.conf

Creating config file /etc/dbconfig-common/multiflexi.conf with new version

Creating config file /etc/multiflexi/.env with new version
checking privileges on database multiflexi for multiflexi@localhost: user creation needed.
granting access to database multiflexi for multiflexi@localhost: success.
verifying access for multiflexi@localhost: success.
creating database multiflexi: success.
verifying database multiflexi exists: success.
dbconfig-common: flushing administrative password
Phinx by CakePHP - https://phinx.org. 0.9.2-3

using config file .usrlibmultiflexiphinx-adapter.php
using config parser php
using migration paths 
 - /usr/lib/multiflexi/db/migrations
using seed paths 
 - /usr/lib/multiflexi/db/seeds
warning no environment specified, defaulting to: production
using adapter mysql
using database multiflexi

 == 20160203130652 User: migrating
 == 20160203130652 User: migrated 0.0181s

 == 20160825235219 Servers: migrating
 == 20160825235219 Servers: migrated 0.0146s

 == 20180208121253 Customer: migrating
 == 20180208121253 Customer: migrated 0.0190s

 == 20180208122200 Company: migrating
 == 20180208122200 Company: migrated 0.0227s

 == 20180310143606 CompanysOwnerIsCustomer: migrating
 == 20180310143606 CompanysOwnerIsCustomer: migrated 0.0223s

 == 20200413063021 Applications: migrating
 == 20200413063021 Applications: migrated 0.0219s

 == 20200413150836 AppToCompany: migrating
 == 20200413150836 AppToCompany: migrated 0.0354s

 == 20200503154326 CompanyNotifyEmail: migrating
 == 20200503154326 CompanyNotifyEmail: migrated 0.0071s

 == 20200520140331 ConfigRegistry: migrating
 == 20200520140331 ConfigRegistry: migrated 0.0440s

 == 20200529215717 AppSetup: migrating
 == 20200529215717 AppSetup: migrated 0.0085s

 == 20200704143315 Logger: migrating
 == 20200704143315 Logger: migrated 0.0227s

 == 20200710133202 CommandlineParams: migrating
 == 20200710133202 CommandlineParams: migrated 0.0079s

 == 20200712203245 DefaultOption: migrating
 == 20200712203245 DefaultOption: migrated 0.0060s

 == 20200713143202 AppIntervalToInterv: migrating
 == 20200713143202 AppIntervalToInterv: migrated 0.0061s

 == 20200713170617 FixCmdlineLogIndex: migrating
 == 20200713170617 FixCmdlineLogIndex: migrated 0.0271s

 == 20210317130152 DefaultCompanySetup: migrating
 == 20210317130152 DefaultCompanySetup: migrated 0.0047s

All Done. Took 0.3214s
run "multiflexi-phinx seed:run" to load demo data
run "multiflexi-phinx seed:run  -s AppSeeder" to load only plugins demo setup
ProjectDir: /usr/lib/multiflexi VendorDir: /var/lib/composer/multiflexi
Loading composer repositories with package information
Updating dependencies
Lock file operations: 10 installs, 0 updates, 0 removals
  - Locking deb/abraflexi (2.10)
  - Locking deb/abraflexi-bricks (0.34)
  - Locking deb/ease-bootstrap4 (1.7)
  - Locking deb/ease-bootstrap4-widgets (1.3)
  - Locking deb/ease-bootstrap4-widgets-abraflexi (0.5)
  - Locking deb/ease-bricks (0.9.9)
  - Locking deb/ease-core (1.35)
  - Locking deb/ease-fluentpdo (1.0)
  - Locking deb/ease-html (1.36)
  - Locking fpdo/fluentpdo (v2.2.0)
Writing lock file
Installing dependencies from lock file (including require-dev)
Package operations: 10 installs, 0 updates, 0 removals
  - Installing deb/ease-core (1.35): Symlinking from /usr/share/php/EaseCore
  - Installing deb/abraflexi (2.10): Symlinking from /usr/share/php/AbraFlexi
  - Installing deb/ease-html (1.36): Symlinking from /usr/share/php/EaseHtml
  - Installing deb/ease-bootstrap4 (1.7): Symlinking from /usr/share/php/EaseTWB4
  - Installing deb/ease-bootstrap4-widgets (1.3): Symlinking from /usr/share/php/EaseTWB4Widgets
  - Installing deb/ease-bricks (0.9.9): Symlinking from /usr/share/php/EaseBricks
  - Installing deb/abraflexi-bricks (0.34): Symlinking from /usr/share/php/AbraFlexiBricks
  - Installing deb/ease-bootstrap4-widgets-abraflexi (0.5): Symlinking from /usr/share/php/EaseTWB4WidgetsAbraFlexi
  - Installing fpdo/fluentpdo (v2.2.0): Extracting archive
  - Installing deb/ease-fluentpdo (1.0): Symlinking from /usr/share/php/EaseFluentPDO
Generating autoload files
/var/lib/composer/multiflexi/autoload.php
Processing triggers for mime-support (3.64ubuntu1) ...
[master 13012c2] committing changes in /etc made by "apt install multiflexi-mysql"
 Author: vitex <vitex@system>
 10 files changed, 162 insertions(+)
 create mode 100644 apache2/conf-available/multiflexi.conf
 create mode 100644 avahi/services/multiflexi.service
 create mode 100644 cron.d/multiflexi
 create mode 100755 cron.daily/multiflexi
 create mode 100755 cron.hourly/multiflexi
 create mode 100755 cron.monthly/multiflexi
 create mode 100755 cron.weekly/multiflexi
 create mode 100644 dbconfig-common/multiflexi.conf
 create mode 100644 multiflexi/.env
```

Po instalaci je pak mo≈æn√© naƒç√≠st buƒè kompletn√≠ demo data ( u≈æivatel **demo** heslo **demo** )

```shell
multiflexi-phinx seed:run
```

Doporuƒçenou mo≈ænost√≠ je v≈°ak zalo≈æit si vlastn√≠ho u≈æivatele a zaregistrovat AbraFlexi server a pot√© pouze naƒç√≠st demo aplikace p≈ô√≠kazem:

```shell
multiflexi-phinx seed:run  -s AppSeeder
```

T√≠m se naƒçtou pouze uk√°zkov√© aplikace. Jsou li tyto tak√© nainstalov√°ny (nalezeny na disku) jsou rovnou aktivov√°ny aby je bylo mo≈æn√© p≈ôi≈ôadit k firm√°m a interval≈Øm.

![AppSeeder](doc/appseeder.png?raw=true)

Ovl√°d√°n√≠ z p≈ô√≠kazov√©ho ≈ô√°dku
============================

ve slo≈æce bin se nach√°zej√≠ tyto spou≈°tƒõƒçe r≈Øzn√Ωch funkc√≠:

* `multiflexi-app2json` - exportuje definici aplikace do souboru
* `multiflexi-executor` - periodick√Ω spou≈°tƒõƒç aplikac√≠
* `multiflexi-job2script` - vygeneruje skript s nastaven√≠m prost≈ôed√≠ a p≈ô√≠kazem pro bƒõhu √∫lohy dle jej√≠ho ƒç√≠sla
* `multiflexi-json-app-remover` - na z√°kladƒõ json definice odstran√≠ aplikaci z MultiFlexi
* `multiflexi-json2app` - naƒçte definice aplikace ze souboru
* `multiflexi-probe` - pomocn√Ω n√°stroj pro testov√°n√≠ funkce aplikace

multiflexi-cli
--------------

pou≈æ√≠t√≠: multiflexi-cli <p≈ô√≠kaz> [argument] [id]

p≈ôikazy: version, list, remove

p≈ô√≠klad:

```
$ multiflexi-cli remove app 15
02/20/2024 23:48:51 üåº ‚ù≤MultiFlexi cli‚¶í(15)AbraFlexi send@MultiFlexi\Application‚ù≥ Unassigned from 3 companys
02/20/2024 23:48:53 üåº ‚ù≤MultiFlexi cli‚¶í(15)AbraFlexi send@MultiFlexi\Application‚ù≥ 2 RunTemplate removal
02/20/2024 23:48:56 üåº ‚ù≤MultiFlexi cli‚¶í(15)AbraFlexi send@MultiFlexi\Application‚ù≥ 2 Config fields removed
02/20/2024 23:48:57 üåº ‚ù≤MultiFlexi cli‚¶í(15)AbraFlexi send@MultiFlexi\Application‚ù≥ 881 Jobs removed
Done.
```
