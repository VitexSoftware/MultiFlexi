<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.0</version>
    <date>2025-01-30T12:00:00Z</date>
    <groups>
        <group>
            <uuid>7df96b18f230490a9a0a9e2307226338</uuid>
            <name>Templates/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>a1b2c3d4e5f6789012345678901234ab</uuid>
            <template>MultiFlexi by Zabbix agent</template>
            <name>MultiFlexi by Zabbix agent</name>
            <description>Template for monitoring MultiFlexi job scheduler and automation framework.

This template monitors:
- MultiFlexi system status and services
- Job execution statistics and status
- Company and application metrics
- RunTemplate discovery and monitoring

Requirements:
- MultiFlexi 1.0 or higher
- multiflexi-cli installed and in PATH
- multiflexi-zabbix package installed
- Zabbix agent 2 with UserParameter support

Documentation: https://multiflexi.readthedocs.io/en/latest/zabbix.html

Template Version: 1.0.0
Author: VitexSoftware
License: MIT</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <!-- System Status Items -->
                <item>
                    <uuid>11111111222233334444555566667777</uuid>
                    <name>MultiFlexi: System Status</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>multiflexi.appstatus</key>
                    <delay>5m</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>TEXT</value_type>
                    <description>MultiFlexi system status in JSON format including database, services, and entity counts.</description>
                    <applications>
                        <application>
                            <name>MultiFlexi System</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <uuid>22222222333344445555666677778888</uuid>
                    <name>MultiFlexi: Database Host</name>
                    <type>DEPENDENT</type>
                    <key>multiflexi.db.host</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>0</trends>
                    <value_type>CHAR</value_type>
                    <description>Database hostname from system status</description>
                    <applications>
                        <application>
                            <name>MultiFlexi System</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.db_host</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>multiflexi.appstatus</key>
                    </master_item>
                </item>
                <item>
                    <uuid>33333333444455556666777788889999</uuid>
                    <name>MultiFlexi: Total Applications</name>
                    <type>DEPENDENT</type>
                    <key>multiflexi.applications.total</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>Total number of applications registered in MultiFlexi</description>
                    <applications>
                        <application>
                            <name>MultiFlexi Statistics</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.applications</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>multiflexi.appstatus</key>
                    </master_item>
                </item>
                <item>
                    <uuid>44444444555566667777888899990000</uuid>
                    <name>MultiFlexi: Total Companies</name>
                    <type>DEPENDENT</type>
                    <key>multiflexi.companies.total</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>Total number of companies/tenants in MultiFlexi</description>
                    <applications>
                        <application>
                            <name>MultiFlexi Statistics</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.companies</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>multiflexi.appstatus</key>
                    </master_item>
                </item>
                <item>
                    <uuid>55555555666677778888999900001111</uuid>
                    <name>MultiFlexi: Total RunTemplates</name>
                    <type>DEPENDENT</type>
                    <key>multiflexi.runtemplates.total</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>Total number of RunTemplates configured</description>
                    <applications>
                        <application>
                            <name>MultiFlexi Statistics</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.runtemplates</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>multiflexi.appstatus</key>
                    </master_item>
                </item>
                <item>
                    <uuid>66666666777788889999000011112222</uuid>
                    <name>MultiFlexi: Total Jobs</name>
                    <type>DEPENDENT</type>
                    <key>multiflexi.jobs.total</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>Total number of jobs in database</description>
                    <applications>
                        <application>
                            <name>MultiFlexi Statistics</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.jobs</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>multiflexi.appstatus</key>
                    </master_item>
                </item>
                <!-- Job Status Items -->
                <item>
                    <uuid>77777777888899990000111122223333</uuid>
                    <name>MultiFlexi: Job Status</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>multiflexi.jobstatus</key>
                    <delay>1m</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>TEXT</value_type>
                    <description>Job execution status summary in JSON format</description>
                    <applications>
                        <application>
                            <name>MultiFlexi Jobs</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <!-- Company Discovery -->
                <discovery_rule>
                    <uuid>aaaaaaaa111122223333444455556666</uuid>
                    <name>MultiFlexi: Company Discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>multiflexi.company.lld</key>
                    <delay>1h</delay>
                    <lifetime>7d</lifetime>
                    <description>Discovers companies/tenants in MultiFlexi</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>bbbbbbbb222233334444555566667777</uuid>
                            <name>Company {#COMPANY_NAME}: Status</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>multiflexi.company.status[{#COMPANY_CODE}]</key>
                            <delay>5m</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>UNSIGNED</value_type>
                            <description>Status of company {#COMPANY_NAME} (1=enabled, 0=disabled)</description>
                            <applications>
                                <application>
                                    <name>MultiFlexi Companies</name>
                                </application>
                            </applications>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>cccccccc333344445555666677778888</uuid>
                            <expression>{MultiFlexi by Zabbix agent:multiflexi.company.status[{#COMPANY_CODE}].last()}=0</expression>
                            <name>Company {#COMPANY_NAME} is disabled</name>
                            <priority>INFO</priority>
                            <description>Company {#COMPANY_NAME} ({#COMPANY_CODE}) has been disabled in MultiFlexi.</description>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>dddddddd444455556666777788889999</uuid>
                            <name>Company {#COMPANY_NAME}: Activity</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>MultiFlexi by Zabbix agent</host>
                                        <key>multiflexi.company.status[{#COMPANY_CODE}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
                <!-- RunTemplate Discovery -->
                <discovery_rule>
                    <uuid>eeeeeeee555566667777888899990000</uuid>
                    <name>MultiFlexi: RunTemplate Discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>multiflexi.runtemplate.lld</key>
                    <delay>1h</delay>
                    <lifetime>7d</lifetime>
                    <description>Discovers RunTemplates with their applications and companies</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>ffffffff666677778888999900001111</uuid>
                            <name>{#COMPANY_NAME} - {#APPNAME}: Job Success Rate</name>
                            <type>CALCULATED</type>
                            <key>multiflexi.job.success_rate[{#COMPANY_CODE},{#APPNAME_CODE}]</key>
                            <delay>5m</delay>
                            <history>30d</history>
                            <trends>90d</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <params>100</params>
                            <description>Success rate for {#APPNAME} jobs in {#COMPANY_NAME}</description>
                            <applications>
                                <application>
                                    <name>MultiFlexi Jobs</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <uuid>00000000777788889999000011112222</uuid>
                            <name>{#COMPANY_NAME} - {#APPNAME}: Last Execution Status</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>multiflexi.job.last_status[{#RUNTEMPLATE}]</key>
                            <delay>1m</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>UNSIGNED</value_type>
                            <description>Last execution status for RunTemplate {#RUNTEMPLATE_NAME} (0=success, 1=failed, 2=running)</description>
                            <applications>
                                <application>
                                    <name>MultiFlexi Jobs</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>MultiFlexi Job Status</name>
                            </valuemap>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>11111111888899990000111122223333</uuid>
                            <expression>{MultiFlexi by Zabbix agent:multiflexi.job.last_status[{#RUNTEMPLATE}].last()}=1</expression>
                            <name>{#COMPANY_NAME} - {#APPNAME}: Job failed</name>
                            <priority>HIGH</priority>
                            <description>RunTemplate {#RUNTEMPLATE_NAME} for {#APPNAME} in {#COMPANY_NAME} has failed.

Company: {#COMPANY_NAME} ({#COMPANY_CODE})
Application: {#APPNAME} ({#APPNAME_CODE})
Interval: {#INTERVAL}
RunTemplate ID: {#RUNTEMPLATE}</description>
                            <dependencies>
                                <dependency>
                                    <name>MultiFlexi: Service is down</name>
                                    <expression>{MultiFlexi by Zabbix agent:net.tcp.service[http,localhost,80].last()}=0</expression>
                                </dependency>
                            </dependencies>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>22222222999900001111222233334444</uuid>
                            <expression>{MultiFlexi by Zabbix agent:multiflexi.job.success_rate[{#COMPANY_CODE},{#APPNAME_CODE}].avg(1h)}&lt;80</expression>
                            <name>{#COMPANY_NAME} - {#APPNAME}: Low success rate</name>
                            <priority>WARNING</priority>
                            <description>Success rate for {#APPNAME} in {#COMPANY_NAME} is below 80% (current: {ITEM.LASTVALUE}).

This may indicate recurring issues with the application or its configuration.</description>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>33333333000011112222333344445555</uuid>
                            <name>{#COMPANY_NAME} - {#APPNAME}: Job Execution</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>MultiFlexi by Zabbix agent</host>
                                        <key>multiflexi.job.success_rate[{#COMPANY_CODE},{#APPNAME_CODE}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
                <!-- Job Discovery -->
                <discovery_rule>
                    <uuid>44444444111122223333444455556666</uuid>
                    <name>MultiFlexi: Job Discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>multiflexi.job.lld</key>
                    <delay>30m</delay>
                    <lifetime>3d</lifetime>
                    <description>Discovers scheduled jobs and tasks</description>
                </discovery_rule>
                <!-- Action Discovery -->
                <discovery_rule>
                    <uuid>55555555222233334444555566667777</uuid>
                    <name>MultiFlexi: Action Discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>multiflexi.action.lld</key>
                    <delay>1h</delay>
                    <lifetime>7d</lifetime>
                    <description>Discovers RunTemplates with Zabbix actions configured</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>66666666333344445555666677778888</uuid>
                            <name>{#RUN_TEMPLATE_NAME}: Success Action Data</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>zabbix_action[{#ZABBIX_KEY_SUCCESS}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Data sent to Zabbix on successful execution of {#RUN_TEMPLATE_NAME}</description>
                            <applications>
                                <application>
                                    <name>MultiFlexi Actions</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <uuid>77777777444455556666777788889999</uuid>
                            <name>{#RUN_TEMPLATE_NAME}: Failure Action Data</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>zabbix_action[{#ZABBIX_KEY_FAIL}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Data sent to Zabbix on failed execution of {#RUN_TEMPLATE_NAME}</description>
                            <applications>
                                <application>
                                    <name>MultiFlexi Actions</name>
                                </application>
                            </applications>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
            </discovery_rules>
            <httptests>
                <httptest>
                    <uuid>88888888555566667777888899990000</uuid>
                    <name>MultiFlexi Web Interface</name>
                    <delay>1m</delay>
                    <attempts>3</attempts>
                    <agent>Zabbix</agent>
                    <steps>
                        <step>
                            <name>Login Page</name>
                            <url>http://localhost/multiflexi/</url>
                            <status_codes>200</status_codes>
                            <no_follow_redirects>NO</no_follow_redirects>
                        </step>
                    </steps>
                </httptest>
            </httptests>
            <triggers>
                <trigger>
                    <uuid>99999999666677778888999900001111</uuid>
                    <expression>{MultiFlexi by Zabbix agent:net.tcp.service[http,localhost,80].last()}=0</expression>
                    <name>MultiFlexi: Service is down</name>
                    <priority>DISASTER</priority>
                    <description>MultiFlexi web service is not responding on port 80.

This may indicate:
- Apache/nginx service is down
- MultiFlexi application error
- Network connectivity issue</description>
                </trigger>
                <trigger>
                    <uuid>aaaaaaaa777788889999000011112222</uuid>
                    <expression>{MultiFlexi by Zabbix agent:multiflexi.companies.total.nodata(30m)}=1</expression>
                    <name>MultiFlexi: No data received</name>
                    <priority>WARNING</priority>
                    <description>No system status data received from MultiFlexi in 30 minutes.

Check:
- Zabbix agent is running
- multiflexi-cli is accessible
- Database connectivity</description>
                </trigger>
            </triggers>
            <macros>
                <macro>
                    <macro>{$MULTIFLEXI.SUCCESS_RATE.MIN}</macro>
                    <value>80</value>
                    <description>Minimum acceptable job success rate (%)</description>
                </macro>
                <macro>
                    <macro>{$MULTIFLEXI.URL}</macro>
                    <value>http://localhost/multiflexi</value>
                    <description>MultiFlexi web interface URL</description>
                </macro>
            </macros>
            <valuemaps>
                <valuemap>
                    <uuid>bbbbbbbb888899990000111122223333</uuid>
                    <name>MultiFlexi Job Status</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>Success</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>Failed</newvalue>
                        </mapping>
                        <mapping>
                            <value>2</value>
                            <newvalue>Running</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>cccccccc999900001111222233334444</uuid>
                    <name>Service state</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>Down</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>Up</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
            </valuemaps>
        </template>
    </templates>
    <graphs>
        <graph>
            <uuid>dddddddd000011112222333344445555</uuid>
            <name>MultiFlexi: Entity Statistics</name>
            <graph_items>
                <graph_item>
                    <sortorder>0</sortorder>
                    <color>1A7C11</color>
                    <item>
                        <host>MultiFlexi by Zabbix agent</host>
                        <key>multiflexi.applications.total</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>MultiFlexi by Zabbix agent</host>
                        <key>multiflexi.companies.total</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>MultiFlexi by Zabbix agent</host>
                        <key>multiflexi.runtemplates.total</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
